package slogserver

import (
	"testing"
	"time"

	slogcrypto "github.com/FrancoLoyola/noroff-fdp/code/pkg/crypto"
	"github.com/FrancoLoyola/noroff-fdp/code/pkg/logging"
)

func TestStorageDecoderV1Bench(t *testing.T) {
	// TO-DO : Benchmark again to 10k if is possible to solve the RSA bottleneck
	nReps := 100 // How many times to decode
	limit := 1.5 // How many seconds to process them

	logger, err := logging.NewInfoLogger()
	if err != nil {
		t.Error("Failed to create logger")
	}

	pass := "my-fancy-password"
	path := "../../../build/keys/storage/slog-storage_rsa"
	privKey, err := slogcrypto.ReadRsaPriv(path, logger)
	if err != nil {
		t.Error("Failed to load the private key", err.Error())
	}

	// Valid uncompressed line
	test := "2021-02-06T15:30:46.1990+01,1,false,3200,3380147044,nalGh9df6SnB0MsBsRsEsb11T4GQ3KUXnEUMMGEIBbTHj3oADkt5fg1QzAdRurZziwUlE9IfCJ//fYS0WkVLxbpOKVfj5p+c/xFfy0hyiCSDJtIt6oOIqy29XvXqVCk5qEdg3f3bT3caxVvqx+hPcanucMytEhgvJ0ih6LD0sWAvLvr8kx3pr1KYUBxb7E7b1dY22eNFRcxv9khJTawmkwcVF5wwV0hXdPfo1RCBdAHfOILB6p3eC++kuv/edT0GhJ1DysjJNUbYR7qo+veGDJWKX6UjK4OqpYEz0PhZwJyV3NL22BfPkr2cMW2LUtmmajtZa/Q1Yv+ytlzzXccuxg==,3790b14f3d30a8b1b2f18251621f81aedb62d613bafb242c41b9942747962d0b6bf1bb8f073f5b6ad45b1d3759f50e3828d768b9e5b611a15dc3717210fe40ef8a7a8cc2fae64193a4e899662c189ea87bd059d808f71c350f91a0793ba85cd89669cad538a06196f548808b4426b1b90a5da576466cb020bb87c4f63632a8a753969efd79f35d94a84ad836479939ddc7f7780bd7426b6858d095775ff75536e12dd96ae9a14ba4b076cb145190d7b05566444b982ba54288a5475271e7349d84db9c43625deba3dce055606409d2741edd3c44031d595ec4be4194f54965d9139575d183a7394026581f0dc696aa4db20a6b81d12210ed8485be83e8ad517fe40a5f380332d743560f05ff2eb40cf9f44e939f61690a03d6bd5212e48ecd006c2302f8181eb703e72420baf73c36da1d983cad42ee4cb0603a4ca93e3470b5f8b82427c4c45588c082202dac76f6737a26c602fe538d9c8e24f1a9d10d19f52a35e3847912a93225c6d28f4a0cb68fab8aca271599e2c259c4420705608529d7b5ad15ce6ba5fed61b0336f3c2049cdbd036b008aa247a9fae46f978db9e090e922cac61f22fd73a6d869d746ed9635f47e1da42b25a547f835d5810aed3ee40c9ee2716adb779e3ac804c498e97c3edee0cb7d9d44633f1ae9b6dbf346416e15cba19623a63d05a74a772642dab57e86a4cc757b0cfff971f5e8f265e36ce6371fae9c72c8601ead2b9d7f74667ca84959515cd89c7f02d057e519e7d2c0ee81b55d72361a473cb0c58657e00bdc134c60768f90b8f700e69194d09527a4c69678917b0eaacee8e6413ac7bfbb1b171fbf07169eba6a80b36f47af77ccb68ab7f494c59dd8a0acefb0f32a16e663b29c54a212124e70c07e3ad756eeba7b571caa779a21e844afb5327c20ee208d9cf80919b3101f7caf8b5dc3aa4d1ab350699e084bffa535ab409ce9227be6daab0c409003a745ccae890e481fbfbb933d9f0edc2f3872edecc6583f5660079599f791722f30fbf6ba60901f0e6131d934a4418d73952472ffd2e269e45b047ad57deadb33069c48cbeff2f838467250a4cf7b422c8480e8e4bb1290c60be7c28a1d95dd5f01995ed7bfe1e711b022eb1f4927963435089862d4fcb0aa11d6f8fc335ddd11c80e5157bbee52946aa420fe369060ac38b55941e37cd3a42987067831569f37ea7cf39a8a4cd725b61025edfb5ca4c25bdbf1b13fe89d389712e9b2f45beb246a1c8c8647062cf7370cd59060287d48b15ab4ebb4ea4a0efc28e83a1fcf553713d95dda1d4b79601d2a29e8f00bb4a492762ac80c3a93b5a4eebdef33413424bd9a6c15d27886f12989856e275ece6ce9559449059525c764333c0fb094a8e7f3cf8f40aea46444f327efdc31617413d62d71308dafe75c4ce77e9c79980c49ea92f6c8bfdbc90c87bb3f988cff3320fed04c4c222c823acc90b008f3b434c713d641e5ffe4e40fd41d8380cc75146c061029df199aabfa143fbc74950539fe95ddda798e1556584f2983c8570ba846d396b53229e5f4372f55ce08870d0839e7876656df45349a201814edd432ca43033c0f02fa056d97f4aa394e22c93ffb011ad83e594bb920d6752d1b2fa58b6007b2bb65bde2112ee125ae6ca8b4ab56ad2a8780c5ca4a36f68f5997e410e37ff3185e7f066e602142477c15d850330e2c3df719ca1710ff808988399f15f9b639e15fed404bebea5ce846684af8eea8df908be0a103f189afc2bcf7d52b87fceaa243b2e0c1414c2628fda132ab1c33e13a21664f3edf0535e47d2b8dbded183aeb39ec2d68a3752a1092d777726deeb159e3980bc83eb369d6cce3e85c527c8dcadafa5a11cf42df1e4372ee28e4c45e4a031e281f470520bd26f84af3c461483d62182310a8ba5f7da0d8ea699208fc07dbcc52b4f7751a82587e07c298aaaefcf62481e12490c6f392ca61881f28dcb25ac2b61c1d3545db7d3aeb68681d57bded7aaba3e93aa6fb9ee75cda55e3616bdafaf9b446355e80218381cea433d48c250093ce00975cfd4699e265df5742f8d2c4161c17b9aa45af48f3a46c3ecf0008d9049955bf67e6c4732966218c14ed1e12a5c74f1f56fac837416ef38c879cf9b4e73f9feb093e888959531d0a1b63ca23eb8fdaf754540bce5093c1a63573e3fe3f72d36dd694b16e30a8097c53dd9dc588ee768a4c884a8120670c111ef775cb3cce8a7d99d974bd54ed1bc0265f56290d0c92cc9a301b5"

	start := time.Now()
	// Discard all decoded structs
	for i := 1; i < nReps; i++ {
		storageDecoderV1(test, pass, privKey, logger)
	}
	end := time.Now()
	total := end.Sub(start)

	if total.Seconds() > limit {
		t.Error("Decoding uncompressed lines took longer than expected: ", total.Seconds(), "s")
	}

	// Valid compressed line
	test = "2021-02-06T15:27:34.9217+01,1,true,2228,819771460,AvZv/Zep655QGZb3plAX3OTNkurZ1Avr2vbUoIQ9B+zYOZS8cKBXidRglCUcvZNcclujA713B1xY846rltiEi3rJswdb1xB0giCU0gI86DUpSwEFIFcRP5stXGCCtkEN5hAdpgOfZuUN+Zri2PI6IQMKyuUnb55G+b8tnp8TmschMOxebgpGOY0TeVUPi+CmjIz5DyNaaCoVTNYWqwcZgGKG2yQSXkfAVg7p2eXY48K71yCQmV1C1g+tm0BmNouv7YspvYHO+5YM8MlHhEOzYzWVxB5K2J2zdhrN41CmJpcx+CLt7z76D+euOI76zruMJ2YZZQoJ42KAvJklHNvNXA==,H4sIAAAAAAAA/xSW2RHEMAhDW+LGlMPZfwmZ/O6sHQN6EusX5sa+9BAklTB94kmorNr0XfKq+OaOG8jRa3xVyyJ8ai3/savHTp2H0GKay722Dmi8jRTW4Xjl2O+B6kjkooQ+EaCO2RRyfE0hT+LRKynuV3l9OqbNAbdIIgfG4Kae3NMd7dNIwqIufOgicxoz6yBXO0A8rqg8zJj/qQSw47HeMwTl3O1mHe1b28DU19SLQa8N7JEbDbwXggd7kW8fhOZIeK2hCzseg+8jc97QNJ1JvoxM7JPgIBYxnEmJlvRTS2Z0pZo3NEVAEka5ciBeOwGwT5n6BpygZjXESoEE+im5DNCVi6zpwvqLW3dip+oVwsdKWnLdvdpDCiVo0XBom6+B0N8cuz9ie2RLs0s2dfKg1A1uF6vSdpvf+o34YFqEwrndvdR0MGuZ3dyCcQuy4dvhqILNGY5HaiJO2XQGjTePSTcxUbrjGqMquuVItKTOglUjDGJknoPziMsDSfHn2qMB/HC8ddJcywEvX3cBdj3wXF+4IGkT1+LRGhAykhVPe34OmbxTTu+pQueaVcARK6p6vHNMgN2Qv3QNWoN75GlhJMgzGpHWEwSm7XGt4E8g8PkEN3VXM2c2oDlfVAnI2KN4DFaj7QK3Nr3RApJEx4eLi1RAypILYJ2P9MYPt/HpjpjrkBeVXbU9Ob++G4DwJ7gXD2PE90Wev51fZbUqXNHA7O0qaPVQvK27VuqZ8NMHaWpIJq9ph7EDFVLyHrg/nBHg/L3ByN/kS3r2Kl6LyFXJXzZ7vengOxo89/SMpn4CxsZ7F81AbzCkIM0QxQu8AEl3MvjlPrBUUoYDoqcQr9VmeOfKrslsSGOXlVXdfgq7hKmd5NHs06ZO0YPRsFRtc7lX4pkt5QJ48/tAZO1CAjdCOtAQZFD/Rwbvv3IeexFexY9zn3Ac72hqvxbEbkhHCSle7XrtZ1z/G14d5iEu80/9FCuODA9Dei9CLqMIdg4Vpq5l5EnF3R0XB22Lx0tXZMD5m9rHd4Mz/lMz07Vg6fgYpU9OS0WFtN/yURTW7hIJUnlO/j+amLzK4mUEfFpoVP5gLqab8vKcdP92Ef0gPbNDP0AupTVGmbpK4LdmTvxeIMbd64hEpJO9cT4q6J/3k0oojJgItW6olQlY22Nn6vyHfioiMFJ/CGCn8+7jZdN0xyP5owfin34db7J2Y/rly2rEvEAbxkfGG+5v/A5PD+tZ//8SkjF4Rz2mQCaVWZxb+D+Z663IPDSIBck+zeqL7gttXavfmYxa/W/vE8TogXBWHSVqdtT0Ko6rpJwyk1+xhubDe0+sZB7XZPxfXNZF6KsfJ+jjoSqW3Ybh6jgTxyGU9HWlUDR2zRqxu+36hT52j9X4f5P+M4tS/MNgoDhqq8l9onF2JTMfwXZkcmDj8fgz83iQ/BKv5sHSIXv8GhbgusGfvvabP5GqPYFwduKR2A7fTKjcoyXNFMzs4Dds93LA9bxXUtmcoZEX/F2LncRaaWc43bHWLdQejKwBpYSnijYj52ou9IxqRfOdvxC+XGcDOn7dY7vPnrwB+U3+ISA8jiaJfX2pgnipHQZLiVyjWHJUgfGnkUl2v7rSmbjeIjGVJN0/GvCwmWUKwv+5Wx8UIab9UXD2RsVRexrsGrpt+v27RWvWnoL9aIECjfBVymujEGKLt393fr+Bgb/Nfs0Pa05/711hnHw89EKhi1YIztpBKN/D3xnqD9PqawvC+cP5/oT4/e+xBwGeFGW9ThvfJdUoqliuKsXTJbzbmqkETbK8EmqNc+WCdct35v0Ik6pqoBkcOFEnL9R1ztUblMspFuBQEZi5Yv05QU/NZc1Tbp91P9KD/JfIluPGBZ1nMxE3ASGQTbmGQJHNq+wXumugZnUwfIDtC71b/ZcJ/Deagqe9DOUXMB7LcZA4IL/g0vFzpRcHwBW5NQDIaQssluVBnkxQuxFtytP9oiB5QHUFVTndCpV3iIKMkQ/o8Rh0hOgJuo2jN0clz1bxXFJrbf1p4g3AEcr7KA3iX0PpgZvgv9NNlJSe/bRSNcb5s30iNp4hnpL6VPVdYJDWKsgTyAVvIOd/KziJLiOj9Z8xURgj+y9Ef8gPCN5lRAe5oxVcBKGv+RY9zwBwMheDvKNiTP4FJ/x+Z59W4R+NdCnPSJa+IvanvCWMDHWcv47LzIL3qYxfFdTY8+mzLwAA//8NVt+dcAwAAA=="

	start = time.Now()
	// Discard all decoded structs
	for i := 1; i < nReps; i++ {
		storageDecoderV1(test, pass, privKey, logger)
	}
	end = time.Now()
	total = end.Sub(start)

	if total.Seconds() > limit {
		t.Error("Decoding compressed lines took longer than expected: ", total.Seconds(), "s")
	}

}

func TestDecoderV1(t *testing.T) {
	logger, err := logging.NewInfoLogger()
	if err != nil {
		t.Error("Failed to create logger")
	}

	pass := "my-fancy-password"
	path := "../../../build/keys/storage/slog-storage_rsa"
	privKey, err := slogcrypto.ReadRsaPriv(path, logger)
	if err != nil {
		t.Error("Failed to load the private key", err.Error())
	}

	// TEST 1 : A valid line string
	test := "2021-02-06T15:30:46.1990+01,1,false,3200,3380147044,nalGh9df6SnB0MsBsRsEsb11T4GQ3KUXnEUMMGEIBbTHj3oADkt5fg1QzAdRurZziwUlE9IfCJ//fYS0WkVLxbpOKVfj5p+c/xFfy0hyiCSDJtIt6oOIqy29XvXqVCk5qEdg3f3bT3caxVvqx+hPcanucMytEhgvJ0ih6LD0sWAvLvr8kx3pr1KYUBxb7E7b1dY22eNFRcxv9khJTawmkwcVF5wwV0hXdPfo1RCBdAHfOILB6p3eC++kuv/edT0GhJ1DysjJNUbYR7qo+veGDJWKX6UjK4OqpYEz0PhZwJyV3NL22BfPkr2cMW2LUtmmajtZa/Q1Yv+ytlzzXccuxg==,3790b14f3d30a8b1b2f18251621f81aedb62d613bafb242c41b9942747962d0b6bf1bb8f073f5b6ad45b1d3759f50e3828d768b9e5b611a15dc3717210fe40ef8a7a8cc2fae64193a4e899662c189ea87bd059d808f71c350f91a0793ba85cd89669cad538a06196f548808b4426b1b90a5da576466cb020bb87c4f63632a8a753969efd79f35d94a84ad836479939ddc7f7780bd7426b6858d095775ff75536e12dd96ae9a14ba4b076cb145190d7b05566444b982ba54288a5475271e7349d84db9c43625deba3dce055606409d2741edd3c44031d595ec4be4194f54965d9139575d183a7394026581f0dc696aa4db20a6b81d12210ed8485be83e8ad517fe40a5f380332d743560f05ff2eb40cf9f44e939f61690a03d6bd5212e48ecd006c2302f8181eb703e72420baf73c36da1d983cad42ee4cb0603a4ca93e3470b5f8b82427c4c45588c082202dac76f6737a26c602fe538d9c8e24f1a9d10d19f52a35e3847912a93225c6d28f4a0cb68fab8aca271599e2c259c4420705608529d7b5ad15ce6ba5fed61b0336f3c2049cdbd036b008aa247a9fae46f978db9e090e922cac61f22fd73a6d869d746ed9635f47e1da42b25a547f835d5810aed3ee40c9ee2716adb779e3ac804c498e97c3edee0cb7d9d44633f1ae9b6dbf346416e15cba19623a63d05a74a772642dab57e86a4cc757b0cfff971f5e8f265e36ce6371fae9c72c8601ead2b9d7f74667ca84959515cd89c7f02d057e519e7d2c0ee81b55d72361a473cb0c58657e00bdc134c60768f90b8f700e69194d09527a4c69678917b0eaacee8e6413ac7bfbb1b171fbf07169eba6a80b36f47af77ccb68ab7f494c59dd8a0acefb0f32a16e663b29c54a212124e70c07e3ad756eeba7b571caa779a21e844afb5327c20ee208d9cf80919b3101f7caf8b5dc3aa4d1ab350699e084bffa535ab409ce9227be6daab0c409003a745ccae890e481fbfbb933d9f0edc2f3872edecc6583f5660079599f791722f30fbf6ba60901f0e6131d934a4418d73952472ffd2e269e45b047ad57deadb33069c48cbeff2f838467250a4cf7b422c8480e8e4bb1290c60be7c28a1d95dd5f01995ed7bfe1e711b022eb1f4927963435089862d4fcb0aa11d6f8fc335ddd11c80e5157bbee52946aa420fe369060ac38b55941e37cd3a42987067831569f37ea7cf39a8a4cd725b61025edfb5ca4c25bdbf1b13fe89d389712e9b2f45beb246a1c8c8647062cf7370cd59060287d48b15ab4ebb4ea4a0efc28e83a1fcf553713d95dda1d4b79601d2a29e8f00bb4a492762ac80c3a93b5a4eebdef33413424bd9a6c15d27886f12989856e275ece6ce9559449059525c764333c0fb094a8e7f3cf8f40aea46444f327efdc31617413d62d71308dafe75c4ce77e9c79980c49ea92f6c8bfdbc90c87bb3f988cff3320fed04c4c222c823acc90b008f3b434c713d641e5ffe4e40fd41d8380cc75146c061029df199aabfa143fbc74950539fe95ddda798e1556584f2983c8570ba846d396b53229e5f4372f55ce08870d0839e7876656df45349a201814edd432ca43033c0f02fa056d97f4aa394e22c93ffb011ad83e594bb920d6752d1b2fa58b6007b2bb65bde2112ee125ae6ca8b4ab56ad2a8780c5ca4a36f68f5997e410e37ff3185e7f066e602142477c15d850330e2c3df719ca1710ff808988399f15f9b639e15fed404bebea5ce846684af8eea8df908be0a103f189afc2bcf7d52b87fceaa243b2e0c1414c2628fda132ab1c33e13a21664f3edf0535e47d2b8dbded183aeb39ec2d68a3752a1092d777726deeb159e3980bc83eb369d6cce3e85c527c8dcadafa5a11cf42df1e4372ee28e4c45e4a031e281f470520bd26f84af3c461483d62182310a8ba5f7da0d8ea699208fc07dbcc52b4f7751a82587e07c298aaaefcf62481e12490c6f392ca61881f28dcb25ac2b61c1d3545db7d3aeb68681d57bded7aaba3e93aa6fb9ee75cda55e3616bdafaf9b446355e80218381cea433d48c250093ce00975cfd4699e265df5742f8d2c4161c17b9aa45af48f3a46c3ecf0008d9049955bf67e6c4732966218c14ed1e12a5c74f1f56fac837416ef38c879cf9b4e73f9feb093e888959531d0a1b63ca23eb8fdaf754540bce5093c1a63573e3fe3f72d36dd694b16e30a8097c53dd9dc588ee768a4c884a8120670c111ef775cb3cce8a7d99d974bd54ed1bc0265f56290d0c92cc9a301b5"
	got := storageDecoderV1(test, pass, privKey, logger)
	if got.SuspiciousRe {
		t.Error("Correct string marked as suspicious")
	}
	// Test 1.1 : A valid line string, compressed
	test = "2021-02-06T15:27:34.9217+01,1,true,2228,819771460,AvZv/Zep655QGZb3plAX3OTNkurZ1Avr2vbUoIQ9B+zYOZS8cKBXidRglCUcvZNcclujA713B1xY846rltiEi3rJswdb1xB0giCU0gI86DUpSwEFIFcRP5stXGCCtkEN5hAdpgOfZuUN+Zri2PI6IQMKyuUnb55G+b8tnp8TmschMOxebgpGOY0TeVUPi+CmjIz5DyNaaCoVTNYWqwcZgGKG2yQSXkfAVg7p2eXY48K71yCQmV1C1g+tm0BmNouv7YspvYHO+5YM8MlHhEOzYzWVxB5K2J2zdhrN41CmJpcx+CLt7z76D+euOI76zruMJ2YZZQoJ42KAvJklHNvNXA==,H4sIAAAAAAAA/xSW2RHEMAhDW+LGlMPZfwmZ/O6sHQN6EusX5sa+9BAklTB94kmorNr0XfKq+OaOG8jRa3xVyyJ8ai3/savHTp2H0GKay722Dmi8jRTW4Xjl2O+B6kjkooQ+EaCO2RRyfE0hT+LRKynuV3l9OqbNAbdIIgfG4Kae3NMd7dNIwqIufOgicxoz6yBXO0A8rqg8zJj/qQSw47HeMwTl3O1mHe1b28DU19SLQa8N7JEbDbwXggd7kW8fhOZIeK2hCzseg+8jc97QNJ1JvoxM7JPgIBYxnEmJlvRTS2Z0pZo3NEVAEka5ciBeOwGwT5n6BpygZjXESoEE+im5DNCVi6zpwvqLW3dip+oVwsdKWnLdvdpDCiVo0XBom6+B0N8cuz9ie2RLs0s2dfKg1A1uF6vSdpvf+o34YFqEwrndvdR0MGuZ3dyCcQuy4dvhqILNGY5HaiJO2XQGjTePSTcxUbrjGqMquuVItKTOglUjDGJknoPziMsDSfHn2qMB/HC8ddJcywEvX3cBdj3wXF+4IGkT1+LRGhAykhVPe34OmbxTTu+pQueaVcARK6p6vHNMgN2Qv3QNWoN75GlhJMgzGpHWEwSm7XGt4E8g8PkEN3VXM2c2oDlfVAnI2KN4DFaj7QK3Nr3RApJEx4eLi1RAypILYJ2P9MYPt/HpjpjrkBeVXbU9Ob++G4DwJ7gXD2PE90Wev51fZbUqXNHA7O0qaPVQvK27VuqZ8NMHaWpIJq9ph7EDFVLyHrg/nBHg/L3ByN/kS3r2Kl6LyFXJXzZ7vengOxo89/SMpn4CxsZ7F81AbzCkIM0QxQu8AEl3MvjlPrBUUoYDoqcQr9VmeOfKrslsSGOXlVXdfgq7hKmd5NHs06ZO0YPRsFRtc7lX4pkt5QJ48/tAZO1CAjdCOtAQZFD/Rwbvv3IeexFexY9zn3Ac72hqvxbEbkhHCSle7XrtZ1z/G14d5iEu80/9FCuODA9Dei9CLqMIdg4Vpq5l5EnF3R0XB22Lx0tXZMD5m9rHd4Mz/lMz07Vg6fgYpU9OS0WFtN/yURTW7hIJUnlO/j+amLzK4mUEfFpoVP5gLqab8vKcdP92Ef0gPbNDP0AupTVGmbpK4LdmTvxeIMbd64hEpJO9cT4q6J/3k0oojJgItW6olQlY22Nn6vyHfioiMFJ/CGCn8+7jZdN0xyP5owfin34db7J2Y/rly2rEvEAbxkfGG+5v/A5PD+tZ//8SkjF4Rz2mQCaVWZxb+D+Z663IPDSIBck+zeqL7gttXavfmYxa/W/vE8TogXBWHSVqdtT0Ko6rpJwyk1+xhubDe0+sZB7XZPxfXNZF6KsfJ+jjoSqW3Ybh6jgTxyGU9HWlUDR2zRqxu+36hT52j9X4f5P+M4tS/MNgoDhqq8l9onF2JTMfwXZkcmDj8fgz83iQ/BKv5sHSIXv8GhbgusGfvvabP5GqPYFwduKR2A7fTKjcoyXNFMzs4Dds93LA9bxXUtmcoZEX/F2LncRaaWc43bHWLdQejKwBpYSnijYj52ou9IxqRfOdvxC+XGcDOn7dY7vPnrwB+U3+ISA8jiaJfX2pgnipHQZLiVyjWHJUgfGnkUl2v7rSmbjeIjGVJN0/GvCwmWUKwv+5Wx8UIab9UXD2RsVRexrsGrpt+v27RWvWnoL9aIECjfBVymujEGKLt393fr+Bgb/Nfs0Pa05/711hnHw89EKhi1YIztpBKN/D3xnqD9PqawvC+cP5/oT4/e+xBwGeFGW9ThvfJdUoqliuKsXTJbzbmqkETbK8EmqNc+WCdct35v0Ik6pqoBkcOFEnL9R1ztUblMspFuBQEZi5Yv05QU/NZc1Tbp91P9KD/JfIluPGBZ1nMxE3ASGQTbmGQJHNq+wXumugZnUwfIDtC71b/ZcJ/Deagqe9DOUXMB7LcZA4IL/g0vFzpRcHwBW5NQDIaQssluVBnkxQuxFtytP9oiB5QHUFVTndCpV3iIKMkQ/o8Rh0hOgJuo2jN0clz1bxXFJrbf1p4g3AEcr7KA3iX0PpgZvgv9NNlJSe/bRSNcb5s30iNp4hnpL6VPVdYJDWKsgTyAVvIOd/KziJLiOj9Z8xURgj+y9Ef8gPCN5lRAe5oxVcBKGv+RY9zwBwMheDvKNiTP4FJ/x+Z59W4R+NdCnPSJa+IvanvCWMDHWcv47LzIL3qYxfFdTY8+mzLwAA//8NVt+dcAwAAA=="
	got = storageDecoderV1(test, pass, privKey, logger)
	if got.SuspiciousRe {
		t.Error("Correct compressed string marked as suspicious")
	}

	// TEST 2 : Same string as test 1, but changed the timestamp
	test = "2021-02-06T15:31:46.1990+01,1,false,3200,3380147044,nalGh9df6SnB0MsBsRsEsb11T4GQ3KUXnEUMMGEIBbTHj3oADkt5fg1QzAdRurZziwUlE9IfCJ//fYS0WkVLxbpOKVfj5p+c/xFfy0hyiCSDJtIt6oOIqy29XvXqVCk5qEdg3f3bT3caxVvqx+hPcanucMytEhgvJ0ih6LD0sWAvLvr8kx3pr1KYUBxb7E7b1dY22eNFRcxv9khJTawmkwcVF5wwV0hXdPfo1RCBdAHfOILB6p3eC++kuv/edT0GhJ1DysjJNUbYR7qo+veGDJWKX6UjK4OqpYEz0PhZwJyV3NL22BfPkr2cMW2LUtmmajtZa/Q1Yv+ytlzzXccuxg==,3790b14f3d30a8b1b2f18251621f81aedb62d613bafb242c41b9942747962d0b6bf1bb8f073f5b6ad45b1d3759f50e3828d768b9e5b611a15dc3717210fe40ef8a7a8cc2fae64193a4e899662c189ea87bd059d808f71c350f91a0793ba85cd89669cad538a06196f548808b4426b1b90a5da576466cb020bb87c4f63632a8a753969efd79f35d94a84ad836479939ddc7f7780bd7426b6858d095775ff75536e12dd96ae9a14ba4b076cb145190d7b05566444b982ba54288a5475271e7349d84db9c43625deba3dce055606409d2741edd3c44031d595ec4be4194f54965d9139575d183a7394026581f0dc696aa4db20a6b81d12210ed8485be83e8ad517fe40a5f380332d743560f05ff2eb40cf9f44e939f61690a03d6bd5212e48ecd006c2302f8181eb703e72420baf73c36da1d983cad42ee4cb0603a4ca93e3470b5f8b82427c4c45588c082202dac76f6737a26c602fe538d9c8e24f1a9d10d19f52a35e3847912a93225c6d28f4a0cb68fab8aca271599e2c259c4420705608529d7b5ad15ce6ba5fed61b0336f3c2049cdbd036b008aa247a9fae46f978db9e090e922cac61f22fd73a6d869d746ed9635f47e1da42b25a547f835d5810aed3ee40c9ee2716adb779e3ac804c498e97c3edee0cb7d9d44633f1ae9b6dbf346416e15cba19623a63d05a74a772642dab57e86a4cc757b0cfff971f5e8f265e36ce6371fae9c72c8601ead2b9d7f74667ca84959515cd89c7f02d057e519e7d2c0ee81b55d72361a473cb0c58657e00bdc134c60768f90b8f700e69194d09527a4c69678917b0eaacee8e6413ac7bfbb1b171fbf07169eba6a80b36f47af77ccb68ab7f494c59dd8a0acefb0f32a16e663b29c54a212124e70c07e3ad756eeba7b571caa779a21e844afb5327c20ee208d9cf80919b3101f7caf8b5dc3aa4d1ab350699e084bffa535ab409ce9227be6daab0c409003a745ccae890e481fbfbb933d9f0edc2f3872edecc6583f5660079599f791722f30fbf6ba60901f0e6131d934a4418d73952472ffd2e269e45b047ad57deadb33069c48cbeff2f838467250a4cf7b422c8480e8e4bb1290c60be7c28a1d95dd5f01995ed7bfe1e711b022eb1f4927963435089862d4fcb0aa11d6f8fc335ddd11c80e5157bbee52946aa420fe369060ac38b55941e37cd3a42987067831569f37ea7cf39a8a4cd725b61025edfb5ca4c25bdbf1b13fe89d389712e9b2f45beb246a1c8c8647062cf7370cd59060287d48b15ab4ebb4ea4a0efc28e83a1fcf553713d95dda1d4b79601d2a29e8f00bb4a492762ac80c3a93b5a4eebdef33413424bd9a6c15d27886f12989856e275ece6ce9559449059525c764333c0fb094a8e7f3cf8f40aea46444f327efdc31617413d62d71308dafe75c4ce77e9c79980c49ea92f6c8bfdbc90c87bb3f988cff3320fed04c4c222c823acc90b008f3b434c713d641e5ffe4e40fd41d8380cc75146c061029df199aabfa143fbc74950539fe95ddda798e1556584f2983c8570ba846d396b53229e5f4372f55ce08870d0839e7876656df45349a201814edd432ca43033c0f02fa056d97f4aa394e22c93ffb011ad83e594bb920d6752d1b2fa58b6007b2bb65bde2112ee125ae6ca8b4ab56ad2a8780c5ca4a36f68f5997e410e37ff3185e7f066e602142477c15d850330e2c3df719ca1710ff808988399f15f9b639e15fed404bebea5ce846684af8eea8df908be0a103f189afc2bcf7d52b87fceaa243b2e0c1414c2628fda132ab1c33e13a21664f3edf0535e47d2b8dbded183aeb39ec2d68a3752a1092d777726deeb159e3980bc83eb369d6cce3e85c527c8dcadafa5a11cf42df1e4372ee28e4c45e4a031e281f470520bd26f84af3c461483d62182310a8ba5f7da0d8ea699208fc07dbcc52b4f7751a82587e07c298aaaefcf62481e12490c6f392ca61881f28dcb25ac2b61c1d3545db7d3aeb68681d57bded7aaba3e93aa6fb9ee75cda55e3616bdafaf9b446355e80218381cea433d48c250093ce00975cfd4699e265df5742f8d2c4161c17b9aa45af48f3a46c3ecf0008d9049955bf67e6c4732966218c14ed1e12a5c74f1f56fac837416ef38c879cf9b4e73f9feb093e888959531d0a1b63ca23eb8fdaf754540bce5093c1a63573e3fe3f72d36dd694b16e30a8097c53dd9dc588ee768a4c884a8120670c111ef775cb3cce8a7d99d974bd54ed1bc0265f56290d0c92cc9a301b5"
	got = storageDecoderV1(test, pass, privKey, logger)
	if !got.SuspiciousRe {
		t.Error("Timestamp in the string is wrong, should be flagged")
	}

	// TEST 3 : Same string as test 3, but unparsable timestamp
	test = "YYYY-02-06T15:30:46.1990+01,1,false,3200,3380147044,nalGh9df6SnB0MsBsRsEsb11T4GQ3KUXnEUMMGEIBbTHj3oADkt5fg1QzAdRurZziwUlE9IfCJ//fYS0WkVLxbpOKVfj5p+c/xFfy0hyiCSDJtIt6oOIqy29XvXqVCk5qEdg3f3bT3caxVvqx+hPcanucMytEhgvJ0ih6LD0sWAvLvr8kx3pr1KYUBxb7E7b1dY22eNFRcxv9khJTawmkwcVF5wwV0hXdPfo1RCBdAHfOILB6p3eC++kuv/edT0GhJ1DysjJNUbYR7qo+veGDJWKX6UjK4OqpYEz0PhZwJyV3NL22BfPkr2cMW2LUtmmajtZa/Q1Yv+ytlzzXccuxg==,3790b14f3d30a8b1b2f18251621f81aedb62d613bafb242c41b9942747962d0b6bf1bb8f073f5b6ad45b1d3759f50e3828d768b9e5b611a15dc3717210fe40ef8a7a8cc2fae64193a4e899662c189ea87bd059d808f71c350f91a0793ba85cd89669cad538a06196f548808b4426b1b90a5da576466cb020bb87c4f63632a8a753969efd79f35d94a84ad836479939ddc7f7780bd7426b6858d095775ff75536e12dd96ae9a14ba4b076cb145190d7b05566444b982ba54288a5475271e7349d84db9c43625deba3dce055606409d2741edd3c44031d595ec4be4194f54965d9139575d183a7394026581f0dc696aa4db20a6b81d12210ed8485be83e8ad517fe40a5f380332d743560f05ff2eb40cf9f44e939f61690a03d6bd5212e48ecd006c2302f8181eb703e72420baf73c36da1d983cad42ee4cb0603a4ca93e3470b5f8b82427c4c45588c082202dac76f6737a26c602fe538d9c8e24f1a9d10d19f52a35e3847912a93225c6d28f4a0cb68fab8aca271599e2c259c4420705608529d7b5ad15ce6ba5fed61b0336f3c2049cdbd036b008aa247a9fae46f978db9e090e922cac61f22fd73a6d869d746ed9635f47e1da42b25a547f835d5810aed3ee40c9ee2716adb779e3ac804c498e97c3edee0cb7d9d44633f1ae9b6dbf346416e15cba19623a63d05a74a772642dab57e86a4cc757b0cfff971f5e8f265e36ce6371fae9c72c8601ead2b9d7f74667ca84959515cd89c7f02d057e519e7d2c0ee81b55d72361a473cb0c58657e00bdc134c60768f90b8f700e69194d09527a4c69678917b0eaacee8e6413ac7bfbb1b171fbf07169eba6a80b36f47af77ccb68ab7f494c59dd8a0acefb0f32a16e663b29c54a212124e70c07e3ad756eeba7b571caa779a21e844afb5327c20ee208d9cf80919b3101f7caf8b5dc3aa4d1ab350699e084bffa535ab409ce9227be6daab0c409003a745ccae890e481fbfbb933d9f0edc2f3872edecc6583f5660079599f791722f30fbf6ba60901f0e6131d934a4418d73952472ffd2e269e45b047ad57deadb33069c48cbeff2f838467250a4cf7b422c8480e8e4bb1290c60be7c28a1d95dd5f01995ed7bfe1e711b022eb1f4927963435089862d4fcb0aa11d6f8fc335ddd11c80e5157bbee52946aa420fe369060ac38b55941e37cd3a42987067831569f37ea7cf39a8a4cd725b61025edfb5ca4c25bdbf1b13fe89d389712e9b2f45beb246a1c8c8647062cf7370cd59060287d48b15ab4ebb4ea4a0efc28e83a1fcf553713d95dda1d4b79601d2a29e8f00bb4a492762ac80c3a93b5a4eebdef33413424bd9a6c15d27886f12989856e275ece6ce9559449059525c764333c0fb094a8e7f3cf8f40aea46444f327efdc31617413d62d71308dafe75c4ce77e9c79980c49ea92f6c8bfdbc90c87bb3f988cff3320fed04c4c222c823acc90b008f3b434c713d641e5ffe4e40fd41d8380cc75146c061029df199aabfa143fbc74950539fe95ddda798e1556584f2983c8570ba846d396b53229e5f4372f55ce08870d0839e7876656df45349a201814edd432ca43033c0f02fa056d97f4aa394e22c93ffb011ad83e594bb920d6752d1b2fa58b6007b2bb65bde2112ee125ae6ca8b4ab56ad2a8780c5ca4a36f68f5997e410e37ff3185e7f066e602142477c15d850330e2c3df719ca1710ff808988399f15f9b639e15fed404bebea5ce846684af8eea8df908be0a103f189afc2bcf7d52b87fceaa243b2e0c1414c2628fda132ab1c33e13a21664f3edf0535e47d2b8dbded183aeb39ec2d68a3752a1092d777726deeb159e3980bc83eb369d6cce3e85c527c8dcadafa5a11cf42df1e4372ee28e4c45e4a031e281f470520bd26f84af3c461483d62182310a8ba5f7da0d8ea699208fc07dbcc52b4f7751a82587e07c298aaaefcf62481e12490c6f392ca61881f28dcb25ac2b61c1d3545db7d3aeb68681d57bded7aaba3e93aa6fb9ee75cda55e3616bdafaf9b446355e80218381cea433d48c250093ce00975cfd4699e265df5742f8d2c4161c17b9aa45af48f3a46c3ecf0008d9049955bf67e6c4732966218c14ed1e12a5c74f1f56fac837416ef38c879cf9b4e73f9feb093e888959531d0a1b63ca23eb8fdaf754540bce5093c1a63573e3fe3f72d36dd694b16e30a8097c53dd9dc588ee768a4c884a8120670c111ef775cb3cce8a7d99d974bd54ed1bc0265f56290d0c92cc9a301b5"
	got = storageDecoderV1(test, pass, privKey, logger)
	if !got.SuspiciousRe {
		t.Error("Incorrect timestamp not flagged")
	}

	// TEST 4 : Same string as test 1, but changed encoder version to some wrong number
	test = "2021-02-06T15:30:46.1990+01,5,false,3200,3380147044,nalGh9df6SnB0MsBsRsEsb11T4GQ3KUXnEUMMGEIBbTHj3oADkt5fg1QzAdRurZziwUlE9IfCJ//fYS0WkVLxbpOKVfj5p+c/xFfy0hyiCSDJtIt6oOIqy29XvXqVCk5qEdg3f3bT3caxVvqx+hPcanucMytEhgvJ0ih6LD0sWAvLvr8kx3pr1KYUBxb7E7b1dY22eNFRcxv9khJTawmkwcVF5wwV0hXdPfo1RCBdAHfOILB6p3eC++kuv/edT0GhJ1DysjJNUbYR7qo+veGDJWKX6UjK4OqpYEz0PhZwJyV3NL22BfPkr2cMW2LUtmmajtZa/Q1Yv+ytlzzXccuxg==,3790b14f3d30a8b1b2f18251621f81aedb62d613bafb242c41b9942747962d0b6bf1bb8f073f5b6ad45b1d3759f50e3828d768b9e5b611a15dc3717210fe40ef8a7a8cc2fae64193a4e899662c189ea87bd059d808f71c350f91a0793ba85cd89669cad538a06196f548808b4426b1b90a5da576466cb020bb87c4f63632a8a753969efd79f35d94a84ad836479939ddc7f7780bd7426b6858d095775ff75536e12dd96ae9a14ba4b076cb145190d7b05566444b982ba54288a5475271e7349d84db9c43625deba3dce055606409d2741edd3c44031d595ec4be4194f54965d9139575d183a7394026581f0dc696aa4db20a6b81d12210ed8485be83e8ad517fe40a5f380332d743560f05ff2eb40cf9f44e939f61690a03d6bd5212e48ecd006c2302f8181eb703e72420baf73c36da1d983cad42ee4cb0603a4ca93e3470b5f8b82427c4c45588c082202dac76f6737a26c602fe538d9c8e24f1a9d10d19f52a35e3847912a93225c6d28f4a0cb68fab8aca271599e2c259c4420705608529d7b5ad15ce6ba5fed61b0336f3c2049cdbd036b008aa247a9fae46f978db9e090e922cac61f22fd73a6d869d746ed9635f47e1da42b25a547f835d5810aed3ee40c9ee2716adb779e3ac804c498e97c3edee0cb7d9d44633f1ae9b6dbf346416e15cba19623a63d05a74a772642dab57e86a4cc757b0cfff971f5e8f265e36ce6371fae9c72c8601ead2b9d7f74667ca84959515cd89c7f02d057e519e7d2c0ee81b55d72361a473cb0c58657e00bdc134c60768f90b8f700e69194d09527a4c69678917b0eaacee8e6413ac7bfbb1b171fbf07169eba6a80b36f47af77ccb68ab7f494c59dd8a0acefb0f32a16e663b29c54a212124e70c07e3ad756eeba7b571caa779a21e844afb5327c20ee208d9cf80919b3101f7caf8b5dc3aa4d1ab350699e084bffa535ab409ce9227be6daab0c409003a745ccae890e481fbfbb933d9f0edc2f3872edecc6583f5660079599f791722f30fbf6ba60901f0e6131d934a4418d73952472ffd2e269e45b047ad57deadb33069c48cbeff2f838467250a4cf7b422c8480e8e4bb1290c60be7c28a1d95dd5f01995ed7bfe1e711b022eb1f4927963435089862d4fcb0aa11d6f8fc335ddd11c80e5157bbee52946aa420fe369060ac38b55941e37cd3a42987067831569f37ea7cf39a8a4cd725b61025edfb5ca4c25bdbf1b13fe89d389712e9b2f45beb246a1c8c8647062cf7370cd59060287d48b15ab4ebb4ea4a0efc28e83a1fcf553713d95dda1d4b79601d2a29e8f00bb4a492762ac80c3a93b5a4eebdef33413424bd9a6c15d27886f12989856e275ece6ce9559449059525c764333c0fb094a8e7f3cf8f40aea46444f327efdc31617413d62d71308dafe75c4ce77e9c79980c49ea92f6c8bfdbc90c87bb3f988cff3320fed04c4c222c823acc90b008f3b434c713d641e5ffe4e40fd41d8380cc75146c061029df199aabfa143fbc74950539fe95ddda798e1556584f2983c8570ba846d396b53229e5f4372f55ce08870d0839e7876656df45349a201814edd432ca43033c0f02fa056d97f4aa394e22c93ffb011ad83e594bb920d6752d1b2fa58b6007b2bb65bde2112ee125ae6ca8b4ab56ad2a8780c5ca4a36f68f5997e410e37ff3185e7f066e602142477c15d850330e2c3df719ca1710ff808988399f15f9b639e15fed404bebea5ce846684af8eea8df908be0a103f189afc2bcf7d52b87fceaa243b2e0c1414c2628fda132ab1c33e13a21664f3edf0535e47d2b8dbded183aeb39ec2d68a3752a1092d777726deeb159e3980bc83eb369d6cce3e85c527c8dcadafa5a11cf42df1e4372ee28e4c45e4a031e281f470520bd26f84af3c461483d62182310a8ba5f7da0d8ea699208fc07dbcc52b4f7751a82587e07c298aaaefcf62481e12490c6f392ca61881f28dcb25ac2b61c1d3545db7d3aeb68681d57bded7aaba3e93aa6fb9ee75cda55e3616bdafaf9b446355e80218381cea433d48c250093ce00975cfd4699e265df5742f8d2c4161c17b9aa45af48f3a46c3ecf0008d9049955bf67e6c4732966218c14ed1e12a5c74f1f56fac837416ef38c879cf9b4e73f9feb093e888959531d0a1b63ca23eb8fdaf754540bce5093c1a63573e3fe3f72d36dd694b16e30a8097c53dd9dc588ee768a4c884a8120670c111ef775cb3cce8a7d99d974bd54ed1bc0265f56290d0c92cc9a301b5"
	got = storageDecoderV1(test, pass, privKey, logger)
	if !got.SuspiciousRe {
		t.Error("Incorrect encoder version not flagged")
	}

	// TEST 5 : Same string as test 1, but changed encoder version to some invalid number
	test = "2021-02-06T15:30:46.1990+01,ENC,false,3200,3380147044,nalGh9df6SnB0MsBsRsEsb11T4GQ3KUXnEUMMGEIBbTHj3oADkt5fg1QzAdRurZziwUlE9IfCJ//fYS0WkVLxbpOKVfj5p+c/xFfy0hyiCSDJtIt6oOIqy29XvXqVCk5qEdg3f3bT3caxVvqx+hPcanucMytEhgvJ0ih6LD0sWAvLvr8kx3pr1KYUBxb7E7b1dY22eNFRcxv9khJTawmkwcVF5wwV0hXdPfo1RCBdAHfOILB6p3eC++kuv/edT0GhJ1DysjJNUbYR7qo+veGDJWKX6UjK4OqpYEz0PhZwJyV3NL22BfPkr2cMW2LUtmmajtZa/Q1Yv+ytlzzXccuxg==,3790b14f3d30a8b1b2f18251621f81aedb62d613bafb242c41b9942747962d0b6bf1bb8f073f5b6ad45b1d3759f50e3828d768b9e5b611a15dc3717210fe40ef8a7a8cc2fae64193a4e899662c189ea87bd059d808f71c350f91a0793ba85cd89669cad538a06196f548808b4426b1b90a5da576466cb020bb87c4f63632a8a753969efd79f35d94a84ad836479939ddc7f7780bd7426b6858d095775ff75536e12dd96ae9a14ba4b076cb145190d7b05566444b982ba54288a5475271e7349d84db9c43625deba3dce055606409d2741edd3c44031d595ec4be4194f54965d9139575d183a7394026581f0dc696aa4db20a6b81d12210ed8485be83e8ad517fe40a5f380332d743560f05ff2eb40cf9f44e939f61690a03d6bd5212e48ecd006c2302f8181eb703e72420baf73c36da1d983cad42ee4cb0603a4ca93e3470b5f8b82427c4c45588c082202dac76f6737a26c602fe538d9c8e24f1a9d10d19f52a35e3847912a93225c6d28f4a0cb68fab8aca271599e2c259c4420705608529d7b5ad15ce6ba5fed61b0336f3c2049cdbd036b008aa247a9fae46f978db9e090e922cac61f22fd73a6d869d746ed9635f47e1da42b25a547f835d5810aed3ee40c9ee2716adb779e3ac804c498e97c3edee0cb7d9d44633f1ae9b6dbf346416e15cba19623a63d05a74a772642dab57e86a4cc757b0cfff971f5e8f265e36ce6371fae9c72c8601ead2b9d7f74667ca84959515cd89c7f02d057e519e7d2c0ee81b55d72361a473cb0c58657e00bdc134c60768f90b8f700e69194d09527a4c69678917b0eaacee8e6413ac7bfbb1b171fbf07169eba6a80b36f47af77ccb68ab7f494c59dd8a0acefb0f32a16e663b29c54a212124e70c07e3ad756eeba7b571caa779a21e844afb5327c20ee208d9cf80919b3101f7caf8b5dc3aa4d1ab350699e084bffa535ab409ce9227be6daab0c409003a745ccae890e481fbfbb933d9f0edc2f3872edecc6583f5660079599f791722f30fbf6ba60901f0e6131d934a4418d73952472ffd2e269e45b047ad57deadb33069c48cbeff2f838467250a4cf7b422c8480e8e4bb1290c60be7c28a1d95dd5f01995ed7bfe1e711b022eb1f4927963435089862d4fcb0aa11d6f8fc335ddd11c80e5157bbee52946aa420fe369060ac38b55941e37cd3a42987067831569f37ea7cf39a8a4cd725b61025edfb5ca4c25bdbf1b13fe89d389712e9b2f45beb246a1c8c8647062cf7370cd59060287d48b15ab4ebb4ea4a0efc28e83a1fcf553713d95dda1d4b79601d2a29e8f00bb4a492762ac80c3a93b5a4eebdef33413424bd9a6c15d27886f12989856e275ece6ce9559449059525c764333c0fb094a8e7f3cf8f40aea46444f327efdc31617413d62d71308dafe75c4ce77e9c79980c49ea92f6c8bfdbc90c87bb3f988cff3320fed04c4c222c823acc90b008f3b434c713d641e5ffe4e40fd41d8380cc75146c061029df199aabfa143fbc74950539fe95ddda798e1556584f2983c8570ba846d396b53229e5f4372f55ce08870d0839e7876656df45349a201814edd432ca43033c0f02fa056d97f4aa394e22c93ffb011ad83e594bb920d6752d1b2fa58b6007b2bb65bde2112ee125ae6ca8b4ab56ad2a8780c5ca4a36f68f5997e410e37ff3185e7f066e602142477c15d850330e2c3df719ca1710ff808988399f15f9b639e15fed404bebea5ce846684af8eea8df908be0a103f189afc2bcf7d52b87fceaa243b2e0c1414c2628fda132ab1c33e13a21664f3edf0535e47d2b8dbded183aeb39ec2d68a3752a1092d777726deeb159e3980bc83eb369d6cce3e85c527c8dcadafa5a11cf42df1e4372ee28e4c45e4a031e281f470520bd26f84af3c461483d62182310a8ba5f7da0d8ea699208fc07dbcc52b4f7751a82587e07c298aaaefcf62481e12490c6f392ca61881f28dcb25ac2b61c1d3545db7d3aeb68681d57bded7aaba3e93aa6fb9ee75cda55e3616bdafaf9b446355e80218381cea433d48c250093ce00975cfd4699e265df5742f8d2c4161c17b9aa45af48f3a46c3ecf0008d9049955bf67e6c4732966218c14ed1e12a5c74f1f56fac837416ef38c879cf9b4e73f9feb093e888959531d0a1b63ca23eb8fdaf754540bce5093c1a63573e3fe3f72d36dd694b16e30a8097c53dd9dc588ee768a4c884a8120670c111ef775cb3cce8a7d99d974bd54ed1bc0265f56290d0c92cc9a301b5"
	got = storageDecoderV1(test, pass, privKey, logger)
	if !got.SuspiciousRe {
		t.Error("Incorrect encoder version not flagged")
	}

	// TEST 6 : Same string as test 1, but with compressing enabled, when data is not
	test = "2021-02-06T15:30:46.1990+01,1,true,3200,3380147044,nalGh9df6SnB0MsBsRsEsb11T4GQ3KUXnEUMMGEIBbTHj3oADkt5fg1QzAdRurZziwUlE9IfCJ//fYS0WkVLxbpOKVfj5p+c/xFfy0hyiCSDJtIt6oOIqy29XvXqVCk5qEdg3f3bT3caxVvqx+hPcanucMytEhgvJ0ih6LD0sWAvLvr8kx3pr1KYUBxb7E7b1dY22eNFRcxv9khJTawmkwcVF5wwV0hXdPfo1RCBdAHfOILB6p3eC++kuv/edT0GhJ1DysjJNUbYR7qo+veGDJWKX6UjK4OqpYEz0PhZwJyV3NL22BfPkr2cMW2LUtmmajtZa/Q1Yv+ytlzzXccuxg==,3790b14f3d30a8b1b2f18251621f81aedb62d613bafb242c41b9942747962d0b6bf1bb8f073f5b6ad45b1d3759f50e3828d768b9e5b611a15dc3717210fe40ef8a7a8cc2fae64193a4e899662c189ea87bd059d808f71c350f91a0793ba85cd89669cad538a06196f548808b4426b1b90a5da576466cb020bb87c4f63632a8a753969efd79f35d94a84ad836479939ddc7f7780bd7426b6858d095775ff75536e12dd96ae9a14ba4b076cb145190d7b05566444b982ba54288a5475271e7349d84db9c43625deba3dce055606409d2741edd3c44031d595ec4be4194f54965d9139575d183a7394026581f0dc696aa4db20a6b81d12210ed8485be83e8ad517fe40a5f380332d743560f05ff2eb40cf9f44e939f61690a03d6bd5212e48ecd006c2302f8181eb703e72420baf73c36da1d983cad42ee4cb0603a4ca93e3470b5f8b82427c4c45588c082202dac76f6737a26c602fe538d9c8e24f1a9d10d19f52a35e3847912a93225c6d28f4a0cb68fab8aca271599e2c259c4420705608529d7b5ad15ce6ba5fed61b0336f3c2049cdbd036b008aa247a9fae46f978db9e090e922cac61f22fd73a6d869d746ed9635f47e1da42b25a547f835d5810aed3ee40c9ee2716adb779e3ac804c498e97c3edee0cb7d9d44633f1ae9b6dbf346416e15cba19623a63d05a74a772642dab57e86a4cc757b0cfff971f5e8f265e36ce6371fae9c72c8601ead2b9d7f74667ca84959515cd89c7f02d057e519e7d2c0ee81b55d72361a473cb0c58657e00bdc134c60768f90b8f700e69194d09527a4c69678917b0eaacee8e6413ac7bfbb1b171fbf07169eba6a80b36f47af77ccb68ab7f494c59dd8a0acefb0f32a16e663b29c54a212124e70c07e3ad756eeba7b571caa779a21e844afb5327c20ee208d9cf80919b3101f7caf8b5dc3aa4d1ab350699e084bffa535ab409ce9227be6daab0c409003a745ccae890e481fbfbb933d9f0edc2f3872edecc6583f5660079599f791722f30fbf6ba60901f0e6131d934a4418d73952472ffd2e269e45b047ad57deadb33069c48cbeff2f838467250a4cf7b422c8480e8e4bb1290c60be7c28a1d95dd5f01995ed7bfe1e711b022eb1f4927963435089862d4fcb0aa11d6f8fc335ddd11c80e5157bbee52946aa420fe369060ac38b55941e37cd3a42987067831569f37ea7cf39a8a4cd725b61025edfb5ca4c25bdbf1b13fe89d389712e9b2f45beb246a1c8c8647062cf7370cd59060287d48b15ab4ebb4ea4a0efc28e83a1fcf553713d95dda1d4b79601d2a29e8f00bb4a492762ac80c3a93b5a4eebdef33413424bd9a6c15d27886f12989856e275ece6ce9559449059525c764333c0fb094a8e7f3cf8f40aea46444f327efdc31617413d62d71308dafe75c4ce77e9c79980c49ea92f6c8bfdbc90c87bb3f988cff3320fed04c4c222c823acc90b008f3b434c713d641e5ffe4e40fd41d8380cc75146c061029df199aabfa143fbc74950539fe95ddda798e1556584f2983c8570ba846d396b53229e5f4372f55ce08870d0839e7876656df45349a201814edd432ca43033c0f02fa056d97f4aa394e22c93ffb011ad83e594bb920d6752d1b2fa58b6007b2bb65bde2112ee125ae6ca8b4ab56ad2a8780c5ca4a36f68f5997e410e37ff3185e7f066e602142477c15d850330e2c3df719ca1710ff808988399f15f9b639e15fed404bebea5ce846684af8eea8df908be0a103f189afc2bcf7d52b87fceaa243b2e0c1414c2628fda132ab1c33e13a21664f3edf0535e47d2b8dbded183aeb39ec2d68a3752a1092d777726deeb159e3980bc83eb369d6cce3e85c527c8dcadafa5a11cf42df1e4372ee28e4c45e4a031e281f470520bd26f84af3c461483d62182310a8ba5f7da0d8ea699208fc07dbcc52b4f7751a82587e07c298aaaefcf62481e12490c6f392ca61881f28dcb25ac2b61c1d3545db7d3aeb68681d57bded7aaba3e93aa6fb9ee75cda55e3616bdafaf9b446355e80218381cea433d48c250093ce00975cfd4699e265df5742f8d2c4161c17b9aa45af48f3a46c3ecf0008d9049955bf67e6c4732966218c14ed1e12a5c74f1f56fac837416ef38c879cf9b4e73f9feb093e888959531d0a1b63ca23eb8fdaf754540bce5093c1a63573e3fe3f72d36dd694b16e30a8097c53dd9dc588ee768a4c884a8120670c111ef775cb3cce8a7d99d974bd54ed1bc0265f56290d0c92cc9a301b5"
	got = storageDecoderV1(test, pass, privKey, logger)
	if !got.SuspiciousRe {
		t.Error("Uncompressed data marked as compressed not flagged")
	}

	// TEST 7 : Same string as test 1, but with invalid compress field
	test = "2021-02-06T15:30:46.1990+01,1,ture,3200,3380147044,nalGh9df6SnB0MsBsRsEsb11T4GQ3KUXnEUMMGEIBbTHj3oADkt5fg1QzAdRurZziwUlE9IfCJ//fYS0WkVLxbpOKVfj5p+c/xFfy0hyiCSDJtIt6oOIqy29XvXqVCk5qEdg3f3bT3caxVvqx+hPcanucMytEhgvJ0ih6LD0sWAvLvr8kx3pr1KYUBxb7E7b1dY22eNFRcxv9khJTawmkwcVF5wwV0hXdPfo1RCBdAHfOILB6p3eC++kuv/edT0GhJ1DysjJNUbYR7qo+veGDJWKX6UjK4OqpYEz0PhZwJyV3NL22BfPkr2cMW2LUtmmajtZa/Q1Yv+ytlzzXccuxg==,3790b14f3d30a8b1b2f18251621f81aedb62d613bafb242c41b9942747962d0b6bf1bb8f073f5b6ad45b1d3759f50e3828d768b9e5b611a15dc3717210fe40ef8a7a8cc2fae64193a4e899662c189ea87bd059d808f71c350f91a0793ba85cd89669cad538a06196f548808b4426b1b90a5da576466cb020bb87c4f63632a8a753969efd79f35d94a84ad836479939ddc7f7780bd7426b6858d095775ff75536e12dd96ae9a14ba4b076cb145190d7b05566444b982ba54288a5475271e7349d84db9c43625deba3dce055606409d2741edd3c44031d595ec4be4194f54965d9139575d183a7394026581f0dc696aa4db20a6b81d12210ed8485be83e8ad517fe40a5f380332d743560f05ff2eb40cf9f44e939f61690a03d6bd5212e48ecd006c2302f8181eb703e72420baf73c36da1d983cad42ee4cb0603a4ca93e3470b5f8b82427c4c45588c082202dac76f6737a26c602fe538d9c8e24f1a9d10d19f52a35e3847912a93225c6d28f4a0cb68fab8aca271599e2c259c4420705608529d7b5ad15ce6ba5fed61b0336f3c2049cdbd036b008aa247a9fae46f978db9e090e922cac61f22fd73a6d869d746ed9635f47e1da42b25a547f835d5810aed3ee40c9ee2716adb779e3ac804c498e97c3edee0cb7d9d44633f1ae9b6dbf346416e15cba19623a63d05a74a772642dab57e86a4cc757b0cfff971f5e8f265e36ce6371fae9c72c8601ead2b9d7f74667ca84959515cd89c7f02d057e519e7d2c0ee81b55d72361a473cb0c58657e00bdc134c60768f90b8f700e69194d09527a4c69678917b0eaacee8e6413ac7bfbb1b171fbf07169eba6a80b36f47af77ccb68ab7f494c59dd8a0acefb0f32a16e663b29c54a212124e70c07e3ad756eeba7b571caa779a21e844afb5327c20ee208d9cf80919b3101f7caf8b5dc3aa4d1ab350699e084bffa535ab409ce9227be6daab0c409003a745ccae890e481fbfbb933d9f0edc2f3872edecc6583f5660079599f791722f30fbf6ba60901f0e6131d934a4418d73952472ffd2e269e45b047ad57deadb33069c48cbeff2f838467250a4cf7b422c8480e8e4bb1290c60be7c28a1d95dd5f01995ed7bfe1e711b022eb1f4927963435089862d4fcb0aa11d6f8fc335ddd11c80e5157bbee52946aa420fe369060ac38b55941e37cd3a42987067831569f37ea7cf39a8a4cd725b61025edfb5ca4c25bdbf1b13fe89d389712e9b2f45beb246a1c8c8647062cf7370cd59060287d48b15ab4ebb4ea4a0efc28e83a1fcf553713d95dda1d4b79601d2a29e8f00bb4a492762ac80c3a93b5a4eebdef33413424bd9a6c15d27886f12989856e275ece6ce9559449059525c764333c0fb094a8e7f3cf8f40aea46444f327efdc31617413d62d71308dafe75c4ce77e9c79980c49ea92f6c8bfdbc90c87bb3f988cff3320fed04c4c222c823acc90b008f3b434c713d641e5ffe4e40fd41d8380cc75146c061029df199aabfa143fbc74950539fe95ddda798e1556584f2983c8570ba846d396b53229e5f4372f55ce08870d0839e7876656df45349a201814edd432ca43033c0f02fa056d97f4aa394e22c93ffb011ad83e594bb920d6752d1b2fa58b6007b2bb65bde2112ee125ae6ca8b4ab56ad2a8780c5ca4a36f68f5997e410e37ff3185e7f066e602142477c15d850330e2c3df719ca1710ff808988399f15f9b639e15fed404bebea5ce846684af8eea8df908be0a103f189afc2bcf7d52b87fceaa243b2e0c1414c2628fda132ab1c33e13a21664f3edf0535e47d2b8dbded183aeb39ec2d68a3752a1092d777726deeb159e3980bc83eb369d6cce3e85c527c8dcadafa5a11cf42df1e4372ee28e4c45e4a031e281f470520bd26f84af3c461483d62182310a8ba5f7da0d8ea699208fc07dbcc52b4f7751a82587e07c298aaaefcf62481e12490c6f392ca61881f28dcb25ac2b61c1d3545db7d3aeb68681d57bded7aaba3e93aa6fb9ee75cda55e3616bdafaf9b446355e80218381cea433d48c250093ce00975cfd4699e265df5742f8d2c4161c17b9aa45af48f3a46c3ecf0008d9049955bf67e6c4732966218c14ed1e12a5c74f1f56fac837416ef38c879cf9b4e73f9feb093e888959531d0a1b63ca23eb8fdaf754540bce5093c1a63573e3fe3f72d36dd694b16e30a8097c53dd9dc588ee768a4c884a8120670c111ef775cb3cce8a7d99d974bd54ed1bc0265f56290d0c92cc9a301b5"
	got = storageDecoderV1(test, pass, privKey, logger)
	if !got.SuspiciousRe {
		t.Error("Invalid compress field not flagged")
	}

	// TEST 8 : Same string as test 1, but with wrong blob length
	test = "2021-02-06T15:30:46.1990+01,1,false,3201,3380147044,nalGh9df6SnB0MsBsRsEsb11T4GQ3KUXnEUMMGEIBbTHj3oADkt5fg1QzAdRurZziwUlE9IfCJ//fYS0WkVLxbpOKVfj5p+c/xFfy0hyiCSDJtIt6oOIqy29XvXqVCk5qEdg3f3bT3caxVvqx+hPcanucMytEhgvJ0ih6LD0sWAvLvr8kx3pr1KYUBxb7E7b1dY22eNFRcxv9khJTawmkwcVF5wwV0hXdPfo1RCBdAHfOILB6p3eC++kuv/edT0GhJ1DysjJNUbYR7qo+veGDJWKX6UjK4OqpYEz0PhZwJyV3NL22BfPkr2cMW2LUtmmajtZa/Q1Yv+ytlzzXccuxg==,3790b14f3d30a8b1b2f18251621f81aedb62d613bafb242c41b9942747962d0b6bf1bb8f073f5b6ad45b1d3759f50e3828d768b9e5b611a15dc3717210fe40ef8a7a8cc2fae64193a4e899662c189ea87bd059d808f71c350f91a0793ba85cd89669cad538a06196f548808b4426b1b90a5da576466cb020bb87c4f63632a8a753969efd79f35d94a84ad836479939ddc7f7780bd7426b6858d095775ff75536e12dd96ae9a14ba4b076cb145190d7b05566444b982ba54288a5475271e7349d84db9c43625deba3dce055606409d2741edd3c44031d595ec4be4194f54965d9139575d183a7394026581f0dc696aa4db20a6b81d12210ed8485be83e8ad517fe40a5f380332d743560f05ff2eb40cf9f44e939f61690a03d6bd5212e48ecd006c2302f8181eb703e72420baf73c36da1d983cad42ee4cb0603a4ca93e3470b5f8b82427c4c45588c082202dac76f6737a26c602fe538d9c8e24f1a9d10d19f52a35e3847912a93225c6d28f4a0cb68fab8aca271599e2c259c4420705608529d7b5ad15ce6ba5fed61b0336f3c2049cdbd036b008aa247a9fae46f978db9e090e922cac61f22fd73a6d869d746ed9635f47e1da42b25a547f835d5810aed3ee40c9ee2716adb779e3ac804c498e97c3edee0cb7d9d44633f1ae9b6dbf346416e15cba19623a63d05a74a772642dab57e86a4cc757b0cfff971f5e8f265e36ce6371fae9c72c8601ead2b9d7f74667ca84959515cd89c7f02d057e519e7d2c0ee81b55d72361a473cb0c58657e00bdc134c60768f90b8f700e69194d09527a4c69678917b0eaacee8e6413ac7bfbb1b171fbf07169eba6a80b36f47af77ccb68ab7f494c59dd8a0acefb0f32a16e663b29c54a212124e70c07e3ad756eeba7b571caa779a21e844afb5327c20ee208d9cf80919b3101f7caf8b5dc3aa4d1ab350699e084bffa535ab409ce9227be6daab0c409003a745ccae890e481fbfbb933d9f0edc2f3872edecc6583f5660079599f791722f30fbf6ba60901f0e6131d934a4418d73952472ffd2e269e45b047ad57deadb33069c48cbeff2f838467250a4cf7b422c8480e8e4bb1290c60be7c28a1d95dd5f01995ed7bfe1e711b022eb1f4927963435089862d4fcb0aa11d6f8fc335ddd11c80e5157bbee52946aa420fe369060ac38b55941e37cd3a42987067831569f37ea7cf39a8a4cd725b61025edfb5ca4c25bdbf1b13fe89d389712e9b2f45beb246a1c8c8647062cf7370cd59060287d48b15ab4ebb4ea4a0efc28e83a1fcf553713d95dda1d4b79601d2a29e8f00bb4a492762ac80c3a93b5a4eebdef33413424bd9a6c15d27886f12989856e275ece6ce9559449059525c764333c0fb094a8e7f3cf8f40aea46444f327efdc31617413d62d71308dafe75c4ce77e9c79980c49ea92f6c8bfdbc90c87bb3f988cff3320fed04c4c222c823acc90b008f3b434c713d641e5ffe4e40fd41d8380cc75146c061029df199aabfa143fbc74950539fe95ddda798e1556584f2983c8570ba846d396b53229e5f4372f55ce08870d0839e7876656df45349a201814edd432ca43033c0f02fa056d97f4aa394e22c93ffb011ad83e594bb920d6752d1b2fa58b6007b2bb65bde2112ee125ae6ca8b4ab56ad2a8780c5ca4a36f68f5997e410e37ff3185e7f066e602142477c15d850330e2c3df719ca1710ff808988399f15f9b639e15fed404bebea5ce846684af8eea8df908be0a103f189afc2bcf7d52b87fceaa243b2e0c1414c2628fda132ab1c33e13a21664f3edf0535e47d2b8dbded183aeb39ec2d68a3752a1092d777726deeb159e3980bc83eb369d6cce3e85c527c8dcadafa5a11cf42df1e4372ee28e4c45e4a031e281f470520bd26f84af3c461483d62182310a8ba5f7da0d8ea699208fc07dbcc52b4f7751a82587e07c298aaaefcf62481e12490c6f392ca61881f28dcb25ac2b61c1d3545db7d3aeb68681d57bded7aaba3e93aa6fb9ee75cda55e3616bdafaf9b446355e80218381cea433d48c250093ce00975cfd4699e265df5742f8d2c4161c17b9aa45af48f3a46c3ecf0008d9049955bf67e6c4732966218c14ed1e12a5c74f1f56fac837416ef38c879cf9b4e73f9feb093e888959531d0a1b63ca23eb8fdaf754540bce5093c1a63573e3fe3f72d36dd694b16e30a8097c53dd9dc588ee768a4c884a8120670c111ef775cb3cce8a7d99d974bd54ed1bc0265f56290d0c92cc9a301b5"
	got = storageDecoderV1(test, pass, privKey, logger)
	if !got.SuspiciousRe {
		t.Error("Wrong blob length not flagged")
	}

	// TEST 9 : Same string as test 1, but with invalid blob length
	test = "2021-02-06T15:30:46.1990+01,1,false,NNNNN,3380147044,nalGh9df6SnB0MsBsRsEsb11T4GQ3KUXnEUMMGEIBbTHj3oADkt5fg1QzAdRurZziwUlE9IfCJ//fYS0WkVLxbpOKVfj5p+c/xFfy0hyiCSDJtIt6oOIqy29XvXqVCk5qEdg3f3bT3caxVvqx+hPcanucMytEhgvJ0ih6LD0sWAvLvr8kx3pr1KYUBxb7E7b1dY22eNFRcxv9khJTawmkwcVF5wwV0hXdPfo1RCBdAHfOILB6p3eC++kuv/edT0GhJ1DysjJNUbYR7qo+veGDJWKX6UjK4OqpYEz0PhZwJyV3NL22BfPkr2cMW2LUtmmajtZa/Q1Yv+ytlzzXccuxg==,3790b14f3d30a8b1b2f18251621f81aedb62d613bafb242c41b9942747962d0b6bf1bb8f073f5b6ad45b1d3759f50e3828d768b9e5b611a15dc3717210fe40ef8a7a8cc2fae64193a4e899662c189ea87bd059d808f71c350f91a0793ba85cd89669cad538a06196f548808b4426b1b90a5da576466cb020bb87c4f63632a8a753969efd79f35d94a84ad836479939ddc7f7780bd7426b6858d095775ff75536e12dd96ae9a14ba4b076cb145190d7b05566444b982ba54288a5475271e7349d84db9c43625deba3dce055606409d2741edd3c44031d595ec4be4194f54965d9139575d183a7394026581f0dc696aa4db20a6b81d12210ed8485be83e8ad517fe40a5f380332d743560f05ff2eb40cf9f44e939f61690a03d6bd5212e48ecd006c2302f8181eb703e72420baf73c36da1d983cad42ee4cb0603a4ca93e3470b5f8b82427c4c45588c082202dac76f6737a26c602fe538d9c8e24f1a9d10d19f52a35e3847912a93225c6d28f4a0cb68fab8aca271599e2c259c4420705608529d7b5ad15ce6ba5fed61b0336f3c2049cdbd036b008aa247a9fae46f978db9e090e922cac61f22fd73a6d869d746ed9635f47e1da42b25a547f835d5810aed3ee40c9ee2716adb779e3ac804c498e97c3edee0cb7d9d44633f1ae9b6dbf346416e15cba19623a63d05a74a772642dab57e86a4cc757b0cfff971f5e8f265e36ce6371fae9c72c8601ead2b9d7f74667ca84959515cd89c7f02d057e519e7d2c0ee81b55d72361a473cb0c58657e00bdc134c60768f90b8f700e69194d09527a4c69678917b0eaacee8e6413ac7bfbb1b171fbf07169eba6a80b36f47af77ccb68ab7f494c59dd8a0acefb0f32a16e663b29c54a212124e70c07e3ad756eeba7b571caa779a21e844afb5327c20ee208d9cf80919b3101f7caf8b5dc3aa4d1ab350699e084bffa535ab409ce9227be6daab0c409003a745ccae890e481fbfbb933d9f0edc2f3872edecc6583f5660079599f791722f30fbf6ba60901f0e6131d934a4418d73952472ffd2e269e45b047ad57deadb33069c48cbeff2f838467250a4cf7b422c8480e8e4bb1290c60be7c28a1d95dd5f01995ed7bfe1e711b022eb1f4927963435089862d4fcb0aa11d6f8fc335ddd11c80e5157bbee52946aa420fe369060ac38b55941e37cd3a42987067831569f37ea7cf39a8a4cd725b61025edfb5ca4c25bdbf1b13fe89d389712e9b2f45beb246a1c8c8647062cf7370cd59060287d48b15ab4ebb4ea4a0efc28e83a1fcf553713d95dda1d4b79601d2a29e8f00bb4a492762ac80c3a93b5a4eebdef33413424bd9a6c15d27886f12989856e275ece6ce9559449059525c764333c0fb094a8e7f3cf8f40aea46444f327efdc31617413d62d71308dafe75c4ce77e9c79980c49ea92f6c8bfdbc90c87bb3f988cff3320fed04c4c222c823acc90b008f3b434c713d641e5ffe4e40fd41d8380cc75146c061029df199aabfa143fbc74950539fe95ddda798e1556584f2983c8570ba846d396b53229e5f4372f55ce08870d0839e7876656df45349a201814edd432ca43033c0f02fa056d97f4aa394e22c93ffb011ad83e594bb920d6752d1b2fa58b6007b2bb65bde2112ee125ae6ca8b4ab56ad2a8780c5ca4a36f68f5997e410e37ff3185e7f066e602142477c15d850330e2c3df719ca1710ff808988399f15f9b639e15fed404bebea5ce846684af8eea8df908be0a103f189afc2bcf7d52b87fceaa243b2e0c1414c2628fda132ab1c33e13a21664f3edf0535e47d2b8dbded183aeb39ec2d68a3752a1092d777726deeb159e3980bc83eb369d6cce3e85c527c8dcadafa5a11cf42df1e4372ee28e4c45e4a031e281f470520bd26f84af3c461483d62182310a8ba5f7da0d8ea699208fc07dbcc52b4f7751a82587e07c298aaaefcf62481e12490c6f392ca61881f28dcb25ac2b61c1d3545db7d3aeb68681d57bded7aaba3e93aa6fb9ee75cda55e3616bdafaf9b446355e80218381cea433d48c250093ce00975cfd4699e265df5742f8d2c4161c17b9aa45af48f3a46c3ecf0008d9049955bf67e6c4732966218c14ed1e12a5c74f1f56fac837416ef38c879cf9b4e73f9feb093e888959531d0a1b63ca23eb8fdaf754540bce5093c1a63573e3fe3f72d36dd694b16e30a8097c53dd9dc588ee768a4c884a8120670c111ef775cb3cce8a7d99d974bd54ed1bc0265f56290d0c92cc9a301b5"
	got = storageDecoderV1(test, pass, privKey, logger)
	if !got.SuspiciousRe {
		t.Error("Invalid blob length not flagged")
	}

	// TEST 10 : Same string as test 1, but with wrong checksum
	test = "2021-02-06T15:30:46.1990+01,1,false,3200,3380147043,nalGh9df6SnB0MsBsRsEsb11T4GQ3KUXnEUMMGEIBbTHj3oADkt5fg1QzAdRurZziwUlE9IfCJ//fYS0WkVLxbpOKVfj5p+c/xFfy0hyiCSDJtIt6oOIqy29XvXqVCk5qEdg3f3bT3caxVvqx+hPcanucMytEhgvJ0ih6LD0sWAvLvr8kx3pr1KYUBxb7E7b1dY22eNFRcxv9khJTawmkwcVF5wwV0hXdPfo1RCBdAHfOILB6p3eC++kuv/edT0GhJ1DysjJNUbYR7qo+veGDJWKX6UjK4OqpYEz0PhZwJyV3NL22BfPkr2cMW2LUtmmajtZa/Q1Yv+ytlzzXccuxg==,3790b14f3d30a8b1b2f18251621f81aedb62d613bafb242c41b9942747962d0b6bf1bb8f073f5b6ad45b1d3759f50e3828d768b9e5b611a15dc3717210fe40ef8a7a8cc2fae64193a4e899662c189ea87bd059d808f71c350f91a0793ba85cd89669cad538a06196f548808b4426b1b90a5da576466cb020bb87c4f63632a8a753969efd79f35d94a84ad836479939ddc7f7780bd7426b6858d095775ff75536e12dd96ae9a14ba4b076cb145190d7b05566444b982ba54288a5475271e7349d84db9c43625deba3dce055606409d2741edd3c44031d595ec4be4194f54965d9139575d183a7394026581f0dc696aa4db20a6b81d12210ed8485be83e8ad517fe40a5f380332d743560f05ff2eb40cf9f44e939f61690a03d6bd5212e48ecd006c2302f8181eb703e72420baf73c36da1d983cad42ee4cb0603a4ca93e3470b5f8b82427c4c45588c082202dac76f6737a26c602fe538d9c8e24f1a9d10d19f52a35e3847912a93225c6d28f4a0cb68fab8aca271599e2c259c4420705608529d7b5ad15ce6ba5fed61b0336f3c2049cdbd036b008aa247a9fae46f978db9e090e922cac61f22fd73a6d869d746ed9635f47e1da42b25a547f835d5810aed3ee40c9ee2716adb779e3ac804c498e97c3edee0cb7d9d44633f1ae9b6dbf346416e15cba19623a63d05a74a772642dab57e86a4cc757b0cfff971f5e8f265e36ce6371fae9c72c8601ead2b9d7f74667ca84959515cd89c7f02d057e519e7d2c0ee81b55d72361a473cb0c58657e00bdc134c60768f90b8f700e69194d09527a4c69678917b0eaacee8e6413ac7bfbb1b171fbf07169eba6a80b36f47af77ccb68ab7f494c59dd8a0acefb0f32a16e663b29c54a212124e70c07e3ad756eeba7b571caa779a21e844afb5327c20ee208d9cf80919b3101f7caf8b5dc3aa4d1ab350699e084bffa535ab409ce9227be6daab0c409003a745ccae890e481fbfbb933d9f0edc2f3872edecc6583f5660079599f791722f30fbf6ba60901f0e6131d934a4418d73952472ffd2e269e45b047ad57deadb33069c48cbeff2f838467250a4cf7b422c8480e8e4bb1290c60be7c28a1d95dd5f01995ed7bfe1e711b022eb1f4927963435089862d4fcb0aa11d6f8fc335ddd11c80e5157bbee52946aa420fe369060ac38b55941e37cd3a42987067831569f37ea7cf39a8a4cd725b61025edfb5ca4c25bdbf1b13fe89d389712e9b2f45beb246a1c8c8647062cf7370cd59060287d48b15ab4ebb4ea4a0efc28e83a1fcf553713d95dda1d4b79601d2a29e8f00bb4a492762ac80c3a93b5a4eebdef33413424bd9a6c15d27886f12989856e275ece6ce9559449059525c764333c0fb094a8e7f3cf8f40aea46444f327efdc31617413d62d71308dafe75c4ce77e9c79980c49ea92f6c8bfdbc90c87bb3f988cff3320fed04c4c222c823acc90b008f3b434c713d641e5ffe4e40fd41d8380cc75146c061029df199aabfa143fbc74950539fe95ddda798e1556584f2983c8570ba846d396b53229e5f4372f55ce08870d0839e7876656df45349a201814edd432ca43033c0f02fa056d97f4aa394e22c93ffb011ad83e594bb920d6752d1b2fa58b6007b2bb65bde2112ee125ae6ca8b4ab56ad2a8780c5ca4a36f68f5997e410e37ff3185e7f066e602142477c15d850330e2c3df719ca1710ff808988399f15f9b639e15fed404bebea5ce846684af8eea8df908be0a103f189afc2bcf7d52b87fceaa243b2e0c1414c2628fda132ab1c33e13a21664f3edf0535e47d2b8dbded183aeb39ec2d68a3752a1092d777726deeb159e3980bc83eb369d6cce3e85c527c8dcadafa5a11cf42df1e4372ee28e4c45e4a031e281f470520bd26f84af3c461483d62182310a8ba5f7da0d8ea699208fc07dbcc52b4f7751a82587e07c298aaaefcf62481e12490c6f392ca61881f28dcb25ac2b61c1d3545db7d3aeb68681d57bded7aaba3e93aa6fb9ee75cda55e3616bdafaf9b446355e80218381cea433d48c250093ce00975cfd4699e265df5742f8d2c4161c17b9aa45af48f3a46c3ecf0008d9049955bf67e6c4732966218c14ed1e12a5c74f1f56fac837416ef38c879cf9b4e73f9feb093e888959531d0a1b63ca23eb8fdaf754540bce5093c1a63573e3fe3f72d36dd694b16e30a8097c53dd9dc588ee768a4c884a8120670c111ef775cb3cce8a7d99d974bd54ed1bc0265f56290d0c92cc9a301b5"
	got = storageDecoderV1(test, pass, privKey, logger)
	if !got.SuspiciousRe {
		t.Error("Wrong checksum not flagged")
	}

	// TEST 11 : Same string as test 1, but with invalid checksum
	test = "2021-02-06T15:30:46.1990+01,1,false,3200,NNNNNNNNNNN,nalGh9df6SnB0MsBsRsEsb11T4GQ3KUXnEUMMGEIBbTHj3oADkt5fg1QzAdRurZziwUlE9IfCJ//fYS0WkVLxbpOKVfj5p+c/xFfy0hyiCSDJtIt6oOIqy29XvXqVCk5qEdg3f3bT3caxVvqx+hPcanucMytEhgvJ0ih6LD0sWAvLvr8kx3pr1KYUBxb7E7b1dY22eNFRcxv9khJTawmkwcVF5wwV0hXdPfo1RCBdAHfOILB6p3eC++kuv/edT0GhJ1DysjJNUbYR7qo+veGDJWKX6UjK4OqpYEz0PhZwJyV3NL22BfPkr2cMW2LUtmmajtZa/Q1Yv+ytlzzXccuxg==,3790b14f3d30a8b1b2f18251621f81aedb62d613bafb242c41b9942747962d0b6bf1bb8f073f5b6ad45b1d3759f50e3828d768b9e5b611a15dc3717210fe40ef8a7a8cc2fae64193a4e899662c189ea87bd059d808f71c350f91a0793ba85cd89669cad538a06196f548808b4426b1b90a5da576466cb020bb87c4f63632a8a753969efd79f35d94a84ad836479939ddc7f7780bd7426b6858d095775ff75536e12dd96ae9a14ba4b076cb145190d7b05566444b982ba54288a5475271e7349d84db9c43625deba3dce055606409d2741edd3c44031d595ec4be4194f54965d9139575d183a7394026581f0dc696aa4db20a6b81d12210ed8485be83e8ad517fe40a5f380332d743560f05ff2eb40cf9f44e939f61690a03d6bd5212e48ecd006c2302f8181eb703e72420baf73c36da1d983cad42ee4cb0603a4ca93e3470b5f8b82427c4c45588c082202dac76f6737a26c602fe538d9c8e24f1a9d10d19f52a35e3847912a93225c6d28f4a0cb68fab8aca271599e2c259c4420705608529d7b5ad15ce6ba5fed61b0336f3c2049cdbd036b008aa247a9fae46f978db9e090e922cac61f22fd73a6d869d746ed9635f47e1da42b25a547f835d5810aed3ee40c9ee2716adb779e3ac804c498e97c3edee0cb7d9d44633f1ae9b6dbf346416e15cba19623a63d05a74a772642dab57e86a4cc757b0cfff971f5e8f265e36ce6371fae9c72c8601ead2b9d7f74667ca84959515cd89c7f02d057e519e7d2c0ee81b55d72361a473cb0c58657e00bdc134c60768f90b8f700e69194d09527a4c69678917b0eaacee8e6413ac7bfbb1b171fbf07169eba6a80b36f47af77ccb68ab7f494c59dd8a0acefb0f32a16e663b29c54a212124e70c07e3ad756eeba7b571caa779a21e844afb5327c20ee208d9cf80919b3101f7caf8b5dc3aa4d1ab350699e084bffa535ab409ce9227be6daab0c409003a745ccae890e481fbfbb933d9f0edc2f3872edecc6583f5660079599f791722f30fbf6ba60901f0e6131d934a4418d73952472ffd2e269e45b047ad57deadb33069c48cbeff2f838467250a4cf7b422c8480e8e4bb1290c60be7c28a1d95dd5f01995ed7bfe1e711b022eb1f4927963435089862d4fcb0aa11d6f8fc335ddd11c80e5157bbee52946aa420fe369060ac38b55941e37cd3a42987067831569f37ea7cf39a8a4cd725b61025edfb5ca4c25bdbf1b13fe89d389712e9b2f45beb246a1c8c8647062cf7370cd59060287d48b15ab4ebb4ea4a0efc28e83a1fcf553713d95dda1d4b79601d2a29e8f00bb4a492762ac80c3a93b5a4eebdef33413424bd9a6c15d27886f12989856e275ece6ce9559449059525c764333c0fb094a8e7f3cf8f40aea46444f327efdc31617413d62d71308dafe75c4ce77e9c79980c49ea92f6c8bfdbc90c87bb3f988cff3320fed04c4c222c823acc90b008f3b434c713d641e5ffe4e40fd41d8380cc75146c061029df199aabfa143fbc74950539fe95ddda798e1556584f2983c8570ba846d396b53229e5f4372f55ce08870d0839e7876656df45349a201814edd432ca43033c0f02fa056d97f4aa394e22c93ffb011ad83e594bb920d6752d1b2fa58b6007b2bb65bde2112ee125ae6ca8b4ab56ad2a8780c5ca4a36f68f5997e410e37ff3185e7f066e602142477c15d850330e2c3df719ca1710ff808988399f15f9b639e15fed404bebea5ce846684af8eea8df908be0a103f189afc2bcf7d52b87fceaa243b2e0c1414c2628fda132ab1c33e13a21664f3edf0535e47d2b8dbded183aeb39ec2d68a3752a1092d777726deeb159e3980bc83eb369d6cce3e85c527c8dcadafa5a11cf42df1e4372ee28e4c45e4a031e281f470520bd26f84af3c461483d62182310a8ba5f7da0d8ea699208fc07dbcc52b4f7751a82587e07c298aaaefcf62481e12490c6f392ca61881f28dcb25ac2b61c1d3545db7d3aeb68681d57bded7aaba3e93aa6fb9ee75cda55e3616bdafaf9b446355e80218381cea433d48c250093ce00975cfd4699e265df5742f8d2c4161c17b9aa45af48f3a46c3ecf0008d9049955bf67e6c4732966218c14ed1e12a5c74f1f56fac837416ef38c879cf9b4e73f9feb093e888959531d0a1b63ca23eb8fdaf754540bce5093c1a63573e3fe3f72d36dd694b16e30a8097c53dd9dc588ee768a4c884a8120670c111ef775cb3cce8a7d99d974bd54ed1bc0265f56290d0c92cc9a301b5"
	got = storageDecoderV1(test, pass, privKey, logger)
	if !got.SuspiciousRe {
		t.Error("Invalid checksum not flagged")
	}

	// TEST 12 : Same string as test 1, but with corrupted blob (missing 5 chars)
	test = "2021-02-06T15:30:46.1990+01,1,false,3200,3380147044,9df6SnB0MsBsRsEsb11T4GQ3KUXnEUMMGEIBbTHj3oADkt5fg1QzAdRurZziwUlE9IfCJ//fYS0WkVLxbpOKVfj5p+c/xFfy0hyiCSDJtIt6oOIqy29XvXqVCk5qEdg3f3bT3caxVvqx+hPcanucMytEhgvJ0ih6LD0sWAvLvr8kx3pr1KYUBxb7E7b1dY22eNFRcxv9khJTawmkwcVF5wwV0hXdPfo1RCBdAHfOILB6p3eC++kuv/edT0GhJ1DysjJNUbYR7qo+veGDJWKX6UjK4OqpYEz0PhZwJyV3NL22BfPkr2cMW2LUtmmajtZa/Q1Yv+ytlzzXccuxg==,3790b14f3d30a8b1b2f18251621f81aedb62d613bafb242c41b9942747962d0b6bf1bb8f073f5b6ad45b1d3759f50e3828d768b9e5b611a15dc3717210fe40ef8a7a8cc2fae64193a4e899662c189ea87bd059d808f71c350f91a0793ba85cd89669cad538a06196f548808b4426b1b90a5da576466cb020bb87c4f63632a8a753969efd79f35d94a84ad836479939ddc7f7780bd7426b6858d095775ff75536e12dd96ae9a14ba4b076cb145190d7b05566444b982ba54288a5475271e7349d84db9c43625deba3dce055606409d2741edd3c44031d595ec4be4194f54965d9139575d183a7394026581f0dc696aa4db20a6b81d12210ed8485be83e8ad517fe40a5f380332d743560f05ff2eb40cf9f44e939f61690a03d6bd5212e48ecd006c2302f8181eb703e72420baf73c36da1d983cad42ee4cb0603a4ca93e3470b5f8b82427c4c45588c082202dac76f6737a26c602fe538d9c8e24f1a9d10d19f52a35e3847912a93225c6d28f4a0cb68fab8aca271599e2c259c4420705608529d7b5ad15ce6ba5fed61b0336f3c2049cdbd036b008aa247a9fae46f978db9e090e922cac61f22fd73a6d869d746ed9635f47e1da42b25a547f835d5810aed3ee40c9ee2716adb779e3ac804c498e97c3edee0cb7d9d44633f1ae9b6dbf346416e15cba19623a63d05a74a772642dab57e86a4cc757b0cfff971f5e8f265e36ce6371fae9c72c8601ead2b9d7f74667ca84959515cd89c7f02d057e519e7d2c0ee81b55d72361a473cb0c58657e00bdc134c60768f90b8f700e69194d09527a4c69678917b0eaacee8e6413ac7bfbb1b171fbf07169eba6a80b36f47af77ccb68ab7f494c59dd8a0acefb0f32a16e663b29c54a212124e70c07e3ad756eeba7b571caa779a21e844afb5327c20ee208d9cf80919b3101f7caf8b5dc3aa4d1ab350699e084bffa535ab409ce9227be6daab0c409003a745ccae890e481fbfbb933d9f0edc2f3872edecc6583f5660079599f791722f30fbf6ba60901f0e6131d934a4418d73952472ffd2e269e45b047ad57deadb33069c48cbeff2f838467250a4cf7b422c8480e8e4bb1290c60be7c28a1d95dd5f01995ed7bfe1e711b022eb1f4927963435089862d4fcb0aa11d6f8fc335ddd11c80e5157bbee52946aa420fe369060ac38b55941e37cd3a42987067831569f37ea7cf39a8a4cd725b61025edfb5ca4c25bdbf1b13fe89d389712e9b2f45beb246a1c8c8647062cf7370cd59060287d48b15ab4ebb4ea4a0efc28e83a1fcf553713d95dda1d4b79601d2a29e8f00bb4a492762ac80c3a93b5a4eebdef33413424bd9a6c15d27886f12989856e275ece6ce9559449059525c764333c0fb094a8e7f3cf8f40aea46444f327efdc31617413d62d71308dafe75c4ce77e9c79980c49ea92f6c8bfdbc90c87bb3f988cff3320fed04c4c222c823acc90b008f3b434c713d641e5ffe4e40fd41d8380cc75146c061029df199aabfa143fbc74950539fe95ddda798e1556584f2983c8570ba846d396b53229e5f4372f55ce08870d0839e7876656df45349a201814edd432ca43033c0f02fa056d97f4aa394e22c93ffb011ad83e594bb920d6752d1b2fa58b6007b2bb65bde2112ee125ae6ca8b4ab56ad2a8780c5ca4a36f68f5997e410e37ff3185e7f066e602142477c15d850330e2c3df719ca1710ff808988399f15f9b639e15fed404bebea5ce846684af8eea8df908be0a103f189afc2bcf7d52b87fceaa243b2e0c1414c2628fda132ab1c33e13a21664f3edf0535e47d2b8dbded183aeb39ec2d68a3752a1092d777726deeb159e3980bc83eb369d6cce3e85c527c8dcadafa5a11cf42df1e4372ee28e4c45e4a031e281f470520bd26f84af3c461483d62182310a8ba5f7da0d8ea699208fc07dbcc52b4f7751a82587e07c298aaaefcf62481e12490c6f392ca61881f28dcb25ac2b61c1d3545db7d3aeb68681d57bded7aaba3e93aa6fb9ee75cda55e3616bdafaf9b446355e80218381cea433d48c250093ce00975cfd4699e265df5742f8d2c4161c17b9aa45af48f3a46c3ecf0008d9049955bf67e6c4732966218c14ed1e12a5c74f1f56fac837416ef38c879cf9b4e73f9feb093e888959531d0a1b63ca23eb8fdaf754540bce5093c1a63573e3fe3f72d36dd694b16e30a8097c53dd9dc588ee768a4c884a8120670c111ef775cb3cce8a7d99d974bd54ed1bc0265f56290d0c92cc9a301b5"
	got = storageDecoderV1(test, pass, privKey, logger)
	if !got.SuspiciousRe {
		t.Error("Corrupted blob field not flagged")
	}
}
